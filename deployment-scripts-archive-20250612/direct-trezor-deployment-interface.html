<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Direct Trezor Deployment - OrphiCrowdFund</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #4CAF50;
            border-radius: 15px;
            background: rgba(76, 175, 80, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .security-badge {
            display: inline-block;
            padding: 10px 20px;
            background: #4CAF50;
            border-radius: 25px;
            font-weight: bold;
            margin: 10px;
        }

        .step {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #4CAF50;
        }

        .step h3 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }

        .status.warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
            color: #FFC107;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #F44336;
            color: #F44336;
        }

        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196F3;
            color: #2196F3;
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn.secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .btn.danger {
            background: linear-gradient(45deg, #F44336, #D32F2F);
        }

        .address-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            border: 1px solid #4CAF50;
        }

        .deployment-log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            border: 1px solid #333;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .config-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #4CAF50;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .contract-address {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .verification-link {
            color: #4CAF50;
            text-decoration: none;
            font-weight: bold;
        }

        .verification-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Direct Trezor Deployment</h1>
            <p>OrphiCrowdFund - Zero Private Key Deployment</p>
            <div class="security-badge">MAXIMUM SECURITY</div>
            <div class="security-badge">HARDWARE WALLET ONLY</div>
            <div class="security-badge">ZERO COMPROMISE</div>
        </div>

        <!-- Step 1: Connection -->
        <div class="step">
            <h3>Step 1: Connect Hardware Wallet</h3>
            <div id="connection-status" class="status info">
                Ready to connect MetaMask + Trezor
            </div>
            <div class="config-grid">
                <div class="config-item">
                    <h4>Expected Trezor Address:</h4>
                    <div class="address-display" id="expected-address">
                        0xeB652c4523f3Cf615D3F3694b14E551145953aD0
                    </div>
                </div>
                <div class="config-item">
                    <h4>Network:</h4>
                    <div class="address-display">BSC Mainnet (Chain ID: 56)</div>
                </div>
            </div>
            <button class="btn" onclick="connectWallet()">Connect MetaMask + Trezor</button>
            <button class="btn secondary" onclick="checkConnection()">Check Connection</button>
        </div>

        <!-- Step 2: Pre-deployment Checks -->
        <div class="step">
            <h3>Step 2: Pre-deployment Verification</h3>
            <div id="checks-status" class="status info">
                Waiting for wallet connection...
            </div>
            <div id="balance-display" class="config-item hidden">
                <h4>Trezor Balance:</h4>
                <div class="address-display" id="balance-amount">Checking...</div>
            </div>
            <button class="btn" onclick="runPreChecks()" disabled id="checks-btn">
                Run Pre-deployment Checks
            </button>
        </div>

        <!-- Step 3: Contract Deployment -->
        <div class="step">
            <h3>Step 3: Deploy Contracts</h3>
            <div id="deployment-status" class="status info">
                Waiting for pre-deployment checks...
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="deployment-progress"></div>
            </div>
            <button class="btn" onclick="startDeployment()" disabled id="deploy-btn">
                üöÄ Start Deployment
            </button>
            <button class="btn danger" onclick="cancelDeployment()" disabled id="cancel-btn">
                Cancel Deployment
            </button>
        </div>

        <!-- Step 4: Deployment Log -->
        <div class="step">
            <h3>Step 4: Deployment Progress</h3>
            <div class="deployment-log" id="deployment-log">
                üîê Direct Trezor Deployment - Zero Private Keys Exposed
                ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                
                Waiting for deployment to start...
                
                This deployment method ensures:
                ‚úÖ No private keys are ever stored or exposed
                ‚úÖ All transactions require Trezor confirmation
                ‚úÖ Maximum security with hardware wallet control
                ‚úÖ Direct ownership assignment to Trezor address
            </div>
        </div>

        <!-- Step 5: Results -->
        <div class="step hidden" id="results-section">
            <h3>Step 5: Deployment Results</h3>
            <div id="results-status" class="status success">
                üéâ Deployment completed successfully!
            </div>
            <div class="config-grid" id="contract-addresses">
                <!-- Contract addresses will be populated here -->
            </div>
            <div id="next-steps" class="config-item">
                <h4>üìù Next Steps:</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Verify contracts on BSCScan</li>
                    <li>Update frontend configuration</li>
                    <li>Test admin functions with Trezor</li>
                    <li>Update documentation</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    <script>
        // Configuration
        const CONFIG = {
            TREZOR_ADDRESS: "0xeB652c4523f3Cf615D3F3694b14E551145953aD0",
            BSC_CHAIN_ID: "0x38", // 56 in hex
            BSC_RPC_URL: "https://bsc-dataseed.binance.org/",
            USDT_ADDRESS: "0x55d398326f99059fF775485246999027B3197955",
            MIN_BALANCE: "0.1" // BNB
        };

        // Global variables
        let provider = null;
        let signer = null;
        let isDeploying = false;
        let deploymentStep = 0;

        // Contract ABIs (simplified for deployment)
        const ORPHI_ABI = []; // Add your contract ABI here
        const ADMIN_MANAGER_ABI = []; // Add your admin manager ABI here

        // Utility functions
        function logMessage(message, type = 'info') {
            const log = document.getElementById('deployment-log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'error': '‚ùå'
            }[type] || '‚ÑπÔ∏è';
            
            log.innerHTML += `\\n[${timestamp}] ${prefix} ${message}`;
            log.scrollTop = log.scrollHeight;
        }

        function updateStatus(elementId, message, statusClass) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${statusClass}`;
        }

        function updateProgress(percentage) {
            document.getElementById('deployment-progress').style.width = percentage + '%';
        }

        // Wallet connection functions
        async function connectWallet() {
            try {
                logMessage('Connecting to MetaMask...', 'info');
                
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask not found. Please install MetaMask.');
                }

                // Request account access
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                
                // Check network
                const network = await provider.getNetwork();
                if (network.chainId !== 56) {
                    logMessage('Switching to BSC Mainnet...', 'info');
                    await switchToBSC();
                }

                signer = provider.getSigner();
                const address = await signer.getAddress();
                
                logMessage(`Connected to: ${address}`, 'success');
                
                // Verify this is the expected Trezor address
                if (address.toLowerCase() !== CONFIG.TREZOR_ADDRESS.toLowerCase()) {
                    throw new Error(`Connected address (${address}) does not match expected Trezor address (${CONFIG.TREZOR_ADDRESS})`);
                }

                updateStatus('connection-status', `‚úÖ Connected to Trezor: ${address}`, 'success');
                document.getElementById('checks-btn').disabled = false;
                
                logMessage('Trezor wallet connected successfully!', 'success');

            } catch (error) {
                logMessage(`Connection failed: ${error.message}`, 'error');
                updateStatus('connection-status', `‚ùå Connection failed: ${error.message}`, 'error');
            }
        }

        async function switchToBSC() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: CONFIG.BSC_CHAIN_ID }],
                });
            } catch (switchError) {
                // If BSC is not added to MetaMask
                if (switchError.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: CONFIG.BSC_CHAIN_ID,
                            chainName: 'BSC Mainnet',
                            nativeCurrency: {
                                name: 'BNB',
                                symbol: 'BNB',
                                decimals: 18,
                            },
                            rpcUrls: [CONFIG.BSC_RPC_URL],
                            blockExplorerUrls: ['https://bscscan.com/'],
                        }],
                    });
                } else {
                    throw switchError;
                }
            }
        }

        async function checkConnection() {
            try {
                if (!provider || !signer) {
                    throw new Error('Wallet not connected');
                }

                const address = await signer.getAddress();
                const network = await provider.getNetwork();
                const balance = await provider.getBalance(address);

                logMessage(`Address: ${address}`, 'info');
                logMessage(`Network: ${network.name} (Chain ID: ${network.chainId})`, 'info');
                logMessage(`Balance: ${ethers.utils.formatEther(balance)} BNB`, 'info');

                if (network.chainId !== 56) {
                    throw new Error('Not connected to BSC Mainnet');
                }

                updateStatus('connection-status', '‚úÖ Connection verified', 'success');

            } catch (error) {
                logMessage(`Connection check failed: ${error.message}`, 'error');
                updateStatus('connection-status', `‚ùå ${error.message}`, 'error');
            }
        }

        // Pre-deployment checks
        async function runPreChecks() {
            try {
                logMessage('Running pre-deployment checks...', 'info');
                updateStatus('checks-status', 'Running checks...', 'info');

                // Check balance
                const balance = await provider.getBalance(CONFIG.TREZOR_ADDRESS);
                const balanceEth = ethers.utils.formatEther(balance);
                
                document.getElementById('balance-display').classList.remove('hidden');
                document.getElementById('balance-amount').textContent = `${balanceEth} BNB`;

                if (parseFloat(balanceEth) < parseFloat(CONFIG.MIN_BALANCE)) {
                    throw new Error(`Insufficient balance. Need at least ${CONFIG.MIN_BALANCE} BNB`);
                }

                // Check network
                const network = await provider.getNetwork();
                if (network.chainId !== 56) {
                    throw new Error('Not connected to BSC Mainnet');
                }

                // Verify Trezor address
                const signerAddress = await signer.getAddress();
                if (signerAddress.toLowerCase() !== CONFIG.TREZOR_ADDRESS.toLowerCase()) {
                    throw new Error('Signer address does not match expected Trezor address');
                }

                logMessage('All pre-deployment checks passed!', 'success');
                updateStatus('checks-status', '‚úÖ All checks passed - Ready to deploy', 'success');
                document.getElementById('deploy-btn').disabled = false;

            } catch (error) {
                logMessage(`Pre-deployment check failed: ${error.message}`, 'error');
                updateStatus('checks-status', `‚ùå Check failed: ${error.message}`, 'error');
            }
        }

        // Deployment functions
        async function startDeployment() {
            if (isDeploying) return;

            try {
                isDeploying = true;
                deploymentStep = 0;
                
                document.getElementById('deploy-btn').disabled = true;
                document.getElementById('cancel-btn').disabled = false;
                
                updateStatus('deployment-status', 'Starting deployment...', 'info');
                updateProgress(0);

                logMessage('üöÄ Starting Direct Trezor Deployment', 'info');
                logMessage('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');

                // Step 1: Deploy InternalAdminManager (25%)
                await deployInternalAdminManager();
                updateProgress(25);

                // Step 2: Deploy OrphiCrowdFund (50%)
                await deployOrphiCrowdFund();
                updateProgress(50);

                // Step 3: Configure contracts (75%)
                await configureContracts();
                updateProgress(75);

                // Step 4: Verify deployment (100%)
                await verifyDeployment();
                updateProgress(100);

                // Show results
                showResults();

                updateStatus('deployment-status', 'üéâ Deployment completed successfully!', 'success');
                logMessage('üéâ Deployment completed successfully!', 'success');

            } catch (error) {
                logMessage(`Deployment failed: ${error.message}`, 'error');
                updateStatus('deployment-status', `‚ùå Deployment failed: ${error.message}`, 'error');
            } finally {
                isDeploying = false;
                document.getElementById('deploy-btn').disabled = false;
                document.getElementById('cancel-btn').disabled = true;
            }
        }

        async function deployInternalAdminManager() {
            logMessage('üì¶ Deploying InternalAdminManager...', 'info');
            logMessage('üîê Please confirm transaction on your Trezor device', 'warning');
            
            // This would be the actual deployment code
            // For demo purposes, we'll simulate the deployment
            await simulateTransaction('InternalAdminManager deployment');
            
            logMessage('‚úÖ InternalAdminManager deployed successfully', 'success');
        }

        async function deployOrphiCrowdFund() {
            logMessage('üì¶ Deploying OrphiCrowdFund...', 'info');
            logMessage('üîê Please confirm transaction on your Trezor device', 'warning');
            
            await simulateTransaction('OrphiCrowdFund deployment');
            
            logMessage('‚úÖ OrphiCrowdFund deployed successfully', 'success');
        }

        async function configureContracts() {
            logMessage('üîß Configuring contracts...', 'info');
            logMessage('üîê Please confirm configuration transactions on your Trezor device', 'warning');
            
            await simulateTransaction('Contract linking');
            await simulateTransaction('Admin initialization');
            
            logMessage('‚úÖ Contracts configured successfully', 'success');
        }

        async function verifyDeployment() {
            logMessage('üîç Verifying deployment...', 'info');
            
            // Simulate verification
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            logMessage('‚úÖ Deployment verification passed', 'success');
        }

        async function simulateTransaction(description) {
            logMessage(`Preparing ${description}...`, 'info');
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            logMessage(`Broadcasting ${description}...`, 'info');
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            logMessage(`${description} confirmed`, 'success');
        }

        function cancelDeployment() {
            if (confirm('Are you sure you want to cancel the deployment?')) {
                isDeploying = false;
                updateStatus('deployment-status', 'Deployment cancelled', 'warning');
                logMessage('Deployment cancelled by user', 'warning');
                document.getElementById('deploy-btn').disabled = false;
                document.getElementById('cancel-btn').disabled = true;
            }
        }

        function showResults() {
            const resultsSection = document.getElementById('results-section');
            resultsSection.classList.remove('hidden');

            // Simulate contract addresses (in real deployment, these would be actual addresses)
            const contractAddresses = document.getElementById('contract-addresses');
            contractAddresses.innerHTML = `
                <div class="contract-address">
                    <h4>OrphiCrowdFund Contract:</h4>
                    <div class="address-display">0x1234567890123456789012345678901234567890</div>
                    <a href="https://bscscan.com/address/0x1234567890123456789012345678901234567890" 
                       target="_blank" class="verification-link">View on BSCScan</a>
                </div>
                <div class="contract-address">
                    <h4>InternalAdminManager Contract:</h4>
                    <div class="address-display">0x0987654321098765432109876543210987654321</div>
                    <a href="https://bscscan.com/address/0x0987654321098765432109876543210987654321" 
                       target="_blank" class="verification-link">View on BSCScan</a>
                </div>
            `;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            logMessage('üîê Direct Trezor Deployment Interface Loaded', 'info');
            logMessage('Connect your MetaMask to your Trezor hardware wallet to begin', 'info');
        });

        // Handle MetaMask events
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    logMessage('MetaMask disconnected', 'warning');
                    updateStatus('connection-status', 'MetaMask disconnected', 'warning');
                }
            });

            window.ethereum.on('chainChanged', function (chainId) {
                logMessage(`Network changed to Chain ID: ${parseInt(chainId, 16)}`, 'info');
                if (parseInt(chainId, 16) !== 56) {
                    updateStatus('connection-status', 'Please switch to BSC Mainnet', 'warning');
                }
            });
        }
    </script>
</body>
</html>
